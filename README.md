# Лаборатория ОС 4 - Проект с динамическими библиотеками

Проект на C с динамическими библиотеками, демонстрирующий статическую и динамическую линковку.

## Структура проекта

- `lib1.c` - Реализация A: ряд Лейбница для Pi, площадь прямоугольника
- `lib2.c` - Реализация B: формула Уоллиса для Pi, площадь прямоугольного треугольника
- `lib.h` - Заголовочный файл с прототипами функций Pi и Square
- `program1.c` - Статическая линковка с lib1.a
- `program2.c` - Динамическая загрузка с переключением библиотек во время выполнения
- `Makefile` - Конфигурация сборки
- `run_tests.sh` - Набор тестов

## Функции

### Pi(int K)
- **Реализация A (lib1)**: Аппроксимация рядом Лейбница
  - Формула: π/4 = 1 - 1/3 + 1/5 - 1/7 + ...
- **Реализация B (lib2)**: Аппроксимация формулой Уоллиса
  - Формула: π/2 = (2/1) × (2/3) × (4/3) × (4/5) × ...

### Square(float A, float B)
- **Реализация A (lib1)**: Площадь прямоугольника
  - Формула: A × B
- **Реализация B (lib2)**: Площадь прямоугольного треугольника
  - Формула: (A × B) / 2

## Сборка

```bash
make
```

Создаются:
- `lib1.so` - Динамическая библиотека реализации A
- `lib2.so` - Динамическая библиотека реализации B
- `lib1.a` - Статическая библиотека реализации A
- `program1` - Исполняемый файл со статической линковкой
- `program2` - Исполняемый файл с динамической загрузкой

## Запуск

### Программа 1 (статическая линковка)
```bash
./program1
```

Статически слинкована с lib1.a (Лейбниц, Прямоугольник).

### Программа 2 (динамическая загрузка)
```bash
./program2
```

Стартует с lib1, может переключаться на lib2 во время выполнения.

## Формат ввода

- `1 K` - Вычислить Pi с K итерациями
- `2 A B` - Вычислить площадь с размерами A и B
- `0` - Переключить библиотеку (только для program2)

## Примеры

### Программа 1
```bash
echo -e "1 1000\n2 5 4" | ./program1
```
Вывод:
```
Pi(K=1000) = 3.140593
Square(A=5.000000, B=4.000000) = 20.000000
```

### Программа 2 - переключение библиотек
```bash
echo -e "1 1000\n2 5 4\n0\n2 5 4\n0\n1 100" | ./program2
```
Вывод:
```
Pi(K=1000) = 3.140593
Square(A=5.000000, B=4.000000) = 20.000000
Square(A=5.000000, B=4.000000) = 10.000000
Pi(K=100) = 3.133788
```

Сообщения о переключении библиотек выводятся в stderr:
```
Switched to ./lib2.so
Switched to ./lib1.so
```

## Тестирование

Запустить набор тестов:
```bash
make test
```

Или напрямую:
```bash
./run_tests.sh
```

## Очистка

Удалить артефакты сборки:
```bash
make clean
```

## Реализованные требования

✓ Две динамические библиотеки (lib1.so, lib2.so)  
✓ Статическая библиотека (lib1.a)  
✓ Каждая реализует Pi(int K) и Square(float A, float B)  
✓ Программа 1: Статическая линковка с lib1.a  
✓ Программа 2: Динамическая загрузка с переключением во время выполнения командой "0"  
✓ Формат ввода: 1 K → Pi, 2 A B → Square  
✓ Улучшенная обработка ошибок с сообщениями в stderr  
✓ Форматированный вывод результатов: Pi(K=...) = ..., Square(A=..., B=...) = ...  
✓ Относительные пути для загрузки библиотек
